import * as tslib_1 from "tslib";
import { Pipe } from '@angular/core';
import { DateTime } from 'luxon';
import { UtilityService } from '../services/utilities.service';
let RangeDatePipe = class RangeDatePipe {
    constructor(utilityService) {
        this.utilityService = utilityService;
        this.days = { 'SU': 'Sun', 'MO': 'Mon', 'TU': 'Tue', 'WE': 'Wed', 'TH': 'Thu', 'FR': 'Fri', 'SA': 'Sat' };
        this.deprecatedVsNewTimeZones = this.utilityService.deprecatedVsNewTimeZones;
        this.transform = (rangeDates, eventTimeZone, isRecurrent, args, hideTime) => {
            if (!eventTimeZone) {
                eventTimeZone = "Asia/Kolkata";
            }
            else {
                if (this.deprecatedVsNewTimeZones[eventTimeZone] != undefined)
                    eventTimeZone = this.deprecatedVsNewTimeZones[eventTimeZone];
            }
            if (rangeDates) {
                // for Recurring events
                if (isRecurrent && args['startTime'] && args['recurrenceRule']) {
                    const startTime = args['startTime'];
                    const freq = args['recurrenceRule'].split(';')[0].split('=')[1];
                    let freqLabel = 'Daily';
                    //custom date selected
                    if (args['recurrenceRule'].indexOf("RDATE") > -1) {
                        freqLabel = 'Multiple Dates';
                    }
                    else {
                        // predefined R Rule
                        if (freq.toLowerCase() == 'Weekly'.toLowerCase()) {
                            let byDays = args['recurrenceRule'].split(';')[2].split('=')[1].split(',');
                            if (byDays.length > 2) {
                                freqLabel = 'Multiple Dates';
                            }
                            else {
                                freqLabel = 'Every ';
                                for (let index = 0; index < byDays.length; index++) {
                                    freqLabel += this.days[byDays[index]];
                                    if (index < (byDays.length - 1)) {
                                        freqLabel += ', ';
                                    }
                                }
                            }
                        }
                    }
                    return freqLabel + ' | ' + startTime;
                }
                else {
                    let local = DateTime.local().setZone(eventTimeZone);
                    // for other events or fallback
                    const date = rangeDates.map(d => DateTime.fromISO(d, { zone: eventTimeZone }).toFormat('dd'));
                    const month = rangeDates.map(d => DateTime.fromISO(d, { zone: eventTimeZone }).toFormat('MMM'));
                    const year = rangeDates.map(d => DateTime.fromISO(d, { zone: eventTimeZone }).toFormat('yy'));
                    const time = DateTime.fromISO(rangeDates[0], { zone: eventTimeZone }).toFormat('hh:mm a');
                    const currYear = new Date().getUTCFullYear() % 100;
                    if (year[0] !== year[1]) {
                        return month[0] + ' ' + date[0] + '\'' + year[0] + ' - ' + month[1] + ' ' + date[1] + '\'' + year[1] + (hideTime ? '' : ' | ' + time);
                    }
                    else {
                        const yearSt = (year[0] - currYear) != 0 ? " '" + year[0] : '';
                        if ((date[0] === date[1]) && (month[0] === month[1])) {
                            return month[0] + ' ' + date[0] + yearSt + (hideTime ? '' : ' | ' + time);
                        }
                        else if ((month[0] !== month[1])) {
                            return month[0] + ' ' + date[0] + yearSt + ' - ' + month[1] + ' ' + date[1] + yearSt + (hideTime ? '' : ' | ' + time);
                        }
                        else {
                            return month[0] + ' ' + date[0] + ' - ' + date[1] + yearSt + (hideTime ? '' : ' | ' + time);
                        }
                    }
                }
            }
            else {
                return null;
            }
        };
    }
};
RangeDatePipe = tslib_1.__decorate([
    Pipe({
        name: 'dateRange'
    }),
    tslib_1.__metadata("design:paramtypes", [UtilityService])
], RangeDatePipe);
export { RangeDatePipe };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHMtZGF0ZS1yYW5nZS5waXBlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHRvd25zY3JpcHQvY29tcG9uZW50cy8iLCJzb3VyY2VzIjpbInNyYy9hcHAvc2hhcmVkL3BpcGVzL3RzLWRhdGUtcmFuZ2UucGlwZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLElBQUksRUFBaUIsTUFBTSxlQUFlLENBQUM7QUFDcEQsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLE9BQU8sQ0FBQztBQUNqQyxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFLL0QsSUFBYSxhQUFhLEdBQTFCLE1BQWEsYUFBYTtJQU10QixZQUFvQixjQUE4QjtRQUE5QixtQkFBYyxHQUFkLGNBQWMsQ0FBZ0I7UUFKbEQsU0FBSSxHQUFRLEVBQUMsSUFBSSxFQUFDLEtBQUssRUFBQyxJQUFJLEVBQUUsS0FBSyxFQUFDLElBQUksRUFBRSxLQUFLLEVBQUMsSUFBSSxFQUFFLEtBQUssRUFBQyxJQUFJLEVBQUUsS0FBSyxFQUFDLElBQUksRUFBRSxLQUFLLEVBQUMsSUFBSSxFQUFFLEtBQUssRUFBQyxDQUFDO1FBRWpHLDZCQUF3QixHQUFTLElBQUksQ0FBQyxjQUFjLENBQUMsd0JBQXdCLENBQUM7UUFNOUUsY0FBUyxHQUFHLENBQUMsVUFBZSxFQUFFLGFBQWtCLEVBQUUsV0FBaUIsRUFBRSxJQUFVLEVBQUUsUUFBa0IsRUFBTyxFQUFFO1lBRXhHLElBQUcsQ0FBQyxhQUFhLEVBQUU7Z0JBQ2YsYUFBYSxHQUFDLGNBQWMsQ0FBQzthQUNoQztpQkFBTTtnQkFDSCxJQUFHLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxhQUFhLENBQUMsSUFBSSxTQUFTO29CQUMxRCxhQUFhLEdBQUcsSUFBSSxDQUFDLHdCQUF3QixDQUFDLGFBQWEsQ0FBQyxDQUFDO2FBQ2xFO1lBRUQsSUFBSSxVQUFVLEVBQUU7Z0JBQ1osdUJBQXVCO2dCQUN2QixJQUFHLFdBQVcsSUFBSSxJ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LENBQUM7b0JBQ2xELElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxLQUFLLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRTt3QkFDdkIsT0FBTyxLQUFLLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLEtBQUssR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFFLEtBQUssR0FBRyxJQUFJLENBQUMsQ0FBQztxQkFDeEk7eUJBQU07d0JBQ0wsTUFBTSxNQUFNLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLEdBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7d0JBQzdELElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUU7NEJBQ3BELE9BQU8sS0FBSyxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLEdBQUcsTUFBTSxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsQ0FBQzt5QkFDM0U7NkJBQU0sSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsS0FBSyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRTs0QkFDbEMsT0FBTyxLQUFLLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBRyxNQUFNLEdBQUcsS0FBSyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLE1BQU0sR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLENBQUM7eUJBQ3ZIOzZCQUFNOzRCQUNMLE9BQU8sS0FBSyxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLEdBQUcsS0FBSyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBRyxNQUFNLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxDQUFDO3lCQUM3RjtxQkFDRjtpQkFDRjthQUNKO2lCQUFNO2dCQUNILE9BQU8sSUFBSSxDQUFDO2FBQ2Y7UUFDTCxDQUFDLENBQUE7SUFqRUQsQ0FBQztDQWtFSixDQUFBO0FBMUVZLGFBQWE7SUFIekIsSUFBSSxDQUFDO1FBQ0YsSUFBSSxFQUFFLFdBQVc7S0FDcEIsQ0FBQzs2Q0FPc0MsY0FBYztHQU56QyxhQUFhLENBMEV6QjtTQTFFWSxhQUFhIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGlwZSwgUGlwZVRyYW5zZm9ybSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRGF0ZVRpbWUgfSBmcm9tICdsdXhvbic7XG5pbXBvcnQgeyBVdGlsaXR5U2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL3V0aWxpdGllcy5zZXJ2aWNlJztcblxuQFBpcGUoe1xuICAgIG5hbWU6ICdkYXRlUmFuZ2UnXG59KVxuZXhwb3J0IGNsYXNzIFJhbmdlRGF0ZVBpcGUgaW1wbGVtZW50cyBQaXBlVHJhbnNmb3JtIHtcblxuICAgIGRheXM6IGFueSA9IHsnU1UnOidTdW4nLCdNTyc6ICdNb24nLCdUVSc6ICdUdWUnLCdXRSc6ICdXZWQnLCdUSCc6ICdUaHUnLCdGUic6ICdGcmknLCdTQSc6ICdTYXQnfTtcblxuICAgIGRlcHJlY2F0ZWRWc05ld1RpbWVab25lcyA6IGFueSA9IHRoaXMudXRpbGl0eVNlcnZpY2UuZGVwcmVjYXRlZFZzTmV3VGltZVpvbmVzO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSB1dGlsaXR5U2VydmljZTogVXRpbGl0eVNlcnZpY2Upe1xuXG4gICAgfVxuXG4gICAgdHJhbnNmb3JtID0gKHJhbmdlRGF0ZXM6IGFueSwgZXZlbnRUaW1lWm9uZTogYW55LCBpc1JlY3VycmVudD86IGFueSAsYXJncz86IGFueSwgaGlkZVRpbWU/OiBib29sZWFuKTogYW55ID0+IHtcblxuICAgICAgICBpZighZXZlbnRUaW1lWm9uZSkge1xuICAgICAgICAgICAgZXZlbnRUaW1lWm9uZT1cIkFzaWEvS29sa2F0YVwiO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYodGhpcy5kZXByZWNhdGVkVnNOZXdUaW1lWm9uZXNbZXZlbnRUaW1lWm9uZV0gIT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICBldmVudFRpbWVab25lID0gdGhpcy5kZXByZWNhdGVkVnNOZXdUaW1lWm9uZXNbZXZlbnRUaW1lWm9uZV07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocmFuZ2VEYXRlcykge1xuICAgICAgICAgICAgLy8gZm9yIFJlY3VycmluZyBldmVudHNcbiAgICAgICAgICAgIGlmKGlzUmVjdXJyZW50ICYmIGFyZ3NbJ3N0YXJ0VGltZSddICYmIGFyZ3NbJ3JlY3VycmVuY2VSdWxlJ10pe1xuXG5cbiAgICAgICAgICAgICAgY29uc3Qgc3RhcnRUaW1lID0gYXJnc1snc3RhcnRUaW1lJ107XG4gICAgICAgICAgICAgIGNvbnN0IGZyZXEgICA9IGFyZ3NbJ3JlY3VycmVuY2VSdWxlJ10uc3BsaXQoJzsnKVswXS5zcGxpdCgnPScpWzFdO1xuICAgICAgICAgICAgICBsZXQgZnJlcUxhYmVsID0gJ0RhaWx5JztcbiAgICAgICAgICAgICAgLy9jdXN0b20gZGF0ZSBzZWxlY3RlZFxuICAgICAgICAgICAgICBpZihhcmdzWydyZWN1cnJlbmNlUnVsZSddLmluZGV4T2YoXCJSREFURVwiKSA+IC0xKXtcbiAgICAgICAgICAgICAgICBmcmVxTGFiZWwgPSAnTXVsdGlwbGUgRGF0ZXMnO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIHByZWRlZmluZWQgUiBSdWxlXG4gICAgICAgICAgICAgICAgaWYoZnJlcS50b0xvd2VyQ2FzZSgpID09ICdXZWVrbHknLnRvTG93ZXJDYXNlKCkpe1xuICAgICAgICAgICAgICAgICAgbGV0IGJ5RGF5cyA9IGFyZ3NbJ3JlY3VycmVuY2VSdWxlJ10uc3BsaXQoJzsnKVsyXS5zcGxpdCgnPScpWzFdLnNwbGl0KCcsJyk7XG4gICAgICAgICAgICAgICAgICBpZihieURheXMubGVuZ3RoID4gMil7XG4gICAgICAgICAgICAgICAgICAgIGZyZXFMYWJlbCA9ICdNdWx0aXBsZSBEYXRlcyc7XG4gICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBmcmVxTGFiZWwgPSAnRXZlcnkgJztcbiAgICAgICAgICAgICAgICAgICAgZm9yKGxldCBpbmRleCA9IDA7aW5kZXggPCBieURheXMubGVuZ3RoOyBpbmRleCsrKXtcbiAgICAgICAgICAgICAgICAgICAgICBmcmVxTGFiZWwgKz0gdGhpcy5kYXlzW2J5RGF5c1tpbmRleF1dO1xuICAgICAgICAgICAgICAgICAgICAgIGlmKGluZGV4IDwgKGJ5RGF5cy5sZW5ndGggLSAxKSl7XG4gICAgICAgICAgICAgICAgICAgICAgICBmcmVxTGFiZWwgKz0gJywgJztcbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgcmV0dXJuICBmcmVxTGFiZWwgKyAnIHwgJyArIHN0YXJ0VGltZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGxldCBsb2NhbCA9IERhdGVUaW1lLmxvY2FsKCkuc2V0Wm9uZShldmVudFRpbWVab25lKTtcbiAgICAgICAgICAgICAgLy8gZm9yIG90aGVyIGV2ZW50cyBvciBmYWxsYmFja1xuICAgICAgICAgICAgICBjb25zdCBkYXRlID0gcmFuZ2VEYXRlcy5tYXAoZCA9PiBEYXRlVGltZS5mcm9tSVNPKGQgLCB7IHpvbmU6IGV2ZW50VGltZVpvbmUgfSkudG9Gb3JtYXQoJ2RkJykpO1xuICAgICAgICAgICAgICBjb25zdCBtb250aCA9IHJhbmdlRGF0ZXMubWFwKGQgPT4gRGF0ZVRpbWUuZnJvbUlTTyhkLCB7IHpvbmU6IGV2ZW50VGltZVpvbmUgfSkudG9Gb3JtYXQoJ01NTScpKTtcbiAgICAgICAgICAgICAgY29uc3QgeWVhciA9IHJhbmdlRGF0ZXMubWFwKGQgPT4gRGF0ZVRpbWUuZnJvbUlTTyhkLCB7IHpvbmU6IGV2ZW50VGltZVpvbmUgfSkudG9Gb3JtYXQoJ3l5JykpO1xuICAgICAgICAgICAgICBjb25zdCB0aW1lID0gRGF0ZVRpbWUuZnJvbUlTTyhyYW5nZURhdGVzWzBdLCB7IHpvbmU6IGV2ZW50VGltZVpvbmUgfSkudG9Gb3JtYXQoJ2hoOm1tIGEnKTtcblxuICAgICAgICAgICAgICBjb25zdCBjdXJyWWVhciA9IG5ldyBEYXRlKCkuZ2V0VVRDRnVsbFllYXIoKSUgMTAwO1xuICAgICAgICAgICAgICBpZiAoeWVhclswXSAhPT0geWVhclsxXSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBtb250aFswXSArICcgJyArIGRhdGVbMF0gKyAnXFwnJyArIHllYXJbMF0gKyAnIC0gJyArIG1vbnRoWzFdICsgJyAnICsgZGF0ZVsxXSArICdcXCcnICsgeWVhclsxXSArIChoaWRlVGltZSA/ICcnIDogICcgfCAnICsgdGltZSk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeWVhclN0ID0gKHllYXJbMF0gLSBjdXJyWWVhcikgIT0gMCA/IFwiICdcIit5ZWFyWzBdIDogJyc7XG4gICAgICAgICAgICAgICAgaWYgKChkYXRlWzBdID09PSBkYXRlWzFdKSAmJiAobW9udGhbMF0gPT09IG1vbnRoWzFdKSkge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIG1vbnRoWzBdICsgJyAnICsgZGF0ZVswXSArIHllYXJTdCArIChoaWRlVGltZSA/ICcnIDogJyB8ICcgKyB0aW1lKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKChtb250aFswXSAhPT0gbW9udGhbMV0pKSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gbW9udGhbMF0gKyAnICcgKyBkYXRlWzBdICsgeWVhclN0ICsgJyAtICcgKyBtb250aFsxXSArICcgJyArIGRhdGVbMV0gKyB5ZWFyU3QgKyAoaGlkZVRpbWUgPyAnJyA6ICcgfCAnICsgdGltZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiBtb250aFswXSArICcgJyArIGRhdGVbMF0gKyAnIC0gJyArIGRhdGVbMV0gKyB5ZWFyU3QgKyAoaGlkZVRpbWUgPyAnJyA6ICcgfCAnICsgdGltZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==