import * as tslib_1 from "tslib";
import { Pipe } from '@angular/core';
import { DateTime } from 'luxon';
import { UtilityService } from '../services/utilities.service';
let RangeDatePipe = class RangeDatePipe {
    constructor(utilityService) {
        this.utilityService = utilityService;
        this.days = { 'SU': 'Sun', 'MO': 'Mon', 'TU': 'Tue', 'WE': 'Wed', 'TH': 'Thu', 'FR': 'Fri', 'SA': 'Sat' };
        this.deprecatedVsNewTimeZones = this.utilityService.deprecatedVsNewTimeZones;
        this.transform = (rangeDates, eventTimeZone, isRecurrent, args, hideTime) => {
            if (!eventTimeZone) {
                eventTimeZone = "Asia/Kolkata";
            }
            else {
                if (this.deprecatedVsNewTimeZones[eventTimeZone] != undefined)
                    eventTimeZone = this.deprecatedVsNewTimeZones[eventTimeZone];
            }
            if (rangeDates) {
                // for Recurring events
                if (isRecurrent && args['startTime'] && args['recurrenceRule']) {
                    const startTime = args['startTime'];
                    const endTime = args['endTime'];
                    const freq = args['recurrenceRule'].split(';')[0].split('=')[1];
                    let freqLabel = 'Daily';
                    //custom date selected
                    if (args['recurrenceRule'].indexOf("RDATE") > -1) {
                        freqLabel = 'Multiple Dates';
                    }
                    else {
                        // predefined R Rule
                        if (freq.toLowerCase() == 'Weekly'.toLowerCase()) {
                            let byDays = args['recurrenceRule'].split(';')[2].split('=')[1].split(',');
                            if (byDays.length > 2) {
                                freqLabel = 'Multiple Dates';
                            }
                            else {
                                freqLabel = 'Every ';
                                for (let index = 0; index < byDays.length; index++) {
                                    freqLabel += this.days[byDays[index]];
                                    if (index < (byDays.length - 1)) {
                                        freqLabel += ', ';
                                    }
                                }
                            }
                        }
                    }
                    return (endTime != undefined ? '' : freqLabel) + (hideTime ? '' : (' | ' + startTime + (endTime != undefined ? ' to ' + endTime : '')));
                }
                else {
                    let local = DateTime.local().setZone(eventTimeZone);
                    // for other events or fallback
                    const date = rangeDates.map(d => DateTime.fromISO(d, { zone: eventTimeZone }).toFormat('dd'));
                    const month = rangeDates.map(d => DateTime.fromISO(d, { zone: eventTimeZone }).toFormat('MMM'));
                    const year = rangeDates.map(d => DateTime.fromISO(d, { zone: eventTimeZone }).toFormat('yy'));
                    const time = DateTime.fromISO(rangeDates[0], { zone: eventTimeZone }).toFormat('hh:mm a');
                    const currYear = new Date().getUTCFullYear() % 100;
                    if (year[0] !== year[1]) {
                        return month[0] + ' ' + date[0] + '\'' + year[0] + ' - ' + month[1] + ' ' + date[1] + '\'' + year[1] + (hideTime ? '' : ' | ' + time);
                    }
                    else {
                        const yearSt = (year[0] - currYear) != 0 ? " '" + year[0] : '';
                        if ((date[0] === date[1]) && (month[0] === month[1])) {
                            return month[0] + ' ' + date[0] + yearSt + (hideTime ? '' : ' | ' + time);
                        }
                        else if ((month[0] !== month[1])) {
                            return month[0] + ' ' + date[0] + yearSt + ' - ' + month[1] + ' ' + date[1] + yearSt + (hideTime ? '' : ' | ' + time);
                        }
                        else {
                            return month[0] + ' ' + date[0] + ' - ' + date[1] + yearSt + (hideTime ? '' : ' | ' + time);
                        }
                    }
                }
            }
            else {
                return null;
            }
        };
    }
};
RangeDatePipe = tslib_1.__decorate([
    Pipe({
        name: 'dateRange'
    }),
    tslib_1.__metadata("design:paramtypes", [UtilityService])
], RangeDatePipe);
export { RangeDatePipe };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHMtZGF0ZS1yYW5nZS5waXBlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHRvd25zY3JpcHQvY29tcG9uZW50cy8iLCJzb3VyY2VzIjpbInNyYy9hcHAvc2hhcmVkL3BpcGVzL3RzLWRhdGUtcmFuZ2UucGlwZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLElBQUksRUFBaUIsTUFBTSxlQUFlLENBQUM7QUFDcEQsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLE9BQU8sQ0FBQztBQUNqQyxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFLL0QsSUFBYSxhQUFhLEdBQTFCLE1BQWEsYUFBYTtJQU10QixZQUFvQixjQUE4QjtRQUE5QixtQkFBYyxHQUFkLGNBQWMsQ0FBZ0I7UUFKbEQsU0FBSSxHQUFRLEVBQUMsSUFBSSxFQUFDLEtBQUssRUFBQyxJQUFJLEVBQUUsS0FBSyxFQUFDLElBQUksRUFBRSxLQUFLLEVBQUMsSUFBSSxFQUFFLEtBQUssRUFBQyxJQUFJLEVBQUUsS0FBSyxFQUFDLElBQUksRUFBRSxLQUFLLEVBQUMsSUFBSSxFQUFFLEtBQUssRUFBQyxDQUFDO1FBRWpHLDZCQUF3QixHQUFTLElBQUksQ0FBQyxjQUFjLENBQUMsd0JBQXdCLENBQUM7UUFNOUUsY0FBUyxHQUFHLENBQUMsVUFBZSxFQUFFLGFBQWtCLEVBQUUsV0FBaUIsRUFBRSxJQUFVLEVBQUUsUUFBa0IsRUFBTyxFQUFFO1lBRXhHLElBQUcsQ0FBQyxhQUFhLEVBQUU7Z0JBQ2YsYUFBYSxHQUFDLGNBQWMsQ0FBQzthQUNoQztpQkFBTTtnQkFDSCxJQUFHLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxhQUFhLENBQUMsSUFBSSxTQUFTO29CQUMxRCxhQUFhLEdBQUcsSUFBSSxDQUFDLHdCQUF3QixDQUFDLGFBQWEsQ0FBQyxDQUFDO2FBQ2xFO1lBRUQsSUFBSSxVQUFVLEVBQUU7Z0JBQ1osdUJBQXVCO2dCQUN2QixJQUFHLFdBQVcsSUFBSSxJ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ci9jb3JlJztcbmltcG9ydCB7IERhdGVUaW1lIH0gZnJvbSAnbHV4b24nO1xuaW1wb3J0IHsgVXRpbGl0eVNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy91dGlsaXRpZXMuc2VydmljZSc7XG5cbkBQaXBlKHtcbiAgICBuYW1lOiAnZGF0ZVJhbmdlJ1xufSlcbmV4cG9ydCBjbGFzcyBSYW5nZURhdGVQaXBlIGltcGxlbWVudHMgUGlwZVRyYW5zZm9ybSB7XG5cbiAgICBkYXlzOiBhbnkgPSB7J1NVJzonU3VuJywnTU8nOiAnTW9uJywnVFUnOiAnVHVlJywnV0UnOiAnV2VkJywnVEgnOiAnVGh1JywnRlInOiAnRnJpJywnU0EnOiAnU2F0J307XG5cbiAgICBkZXByZWNhdGVkVnNOZXdUaW1lWm9uZXMgOiBhbnkgPSB0aGlzLnV0aWxpdHlTZXJ2aWNlLmRlcHJlY2F0ZWRWc05ld1RpbWVab25lcztcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgdXRpbGl0eVNlcnZpY2U6IFV0aWxpdHlTZXJ2aWNlKXtcblxuICAgIH1cblxuICAgIHRyYW5zZm9ybSA9IChyYW5nZURhdGVzOiBhbnksIGV2ZW50VGltZVpvbmU6IGFueSwgaXNSZWN1cnJlbnQ/OiBhbnkgLGFyZ3M/OiBhbnksIGhpZGVUaW1lPzogYm9vbGVhbik6IGFueSA9PiB7XG5cbiAgICAgICAgaWYoIWV2ZW50VGltZVpvbmUpIHtcbiAgICAgICAgICAgIGV2ZW50VGltZVpvbmU9XCJBc2lhL0tvbGthdGFcIjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmKHRoaXMuZGVwcmVjYXRlZFZzTmV3VGltZVpvbmVzW2V2ZW50VGltZVpvbmVdICE9IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgZXZlbnRUaW1lWm9uZSA9IHRoaXMuZGVwcmVjYXRlZFZzTmV3VGltZVpvbmVzW2V2ZW50VGltZVpvbmVdO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHJhbmdlRGF0ZXMpIHtcbiAgICAgICAgICAgIC8vIGZvciBSZWN1cnJpbmcgZXZlbnRzXG4gICAgICAgICAgICBpZihpc1JlY3VycmVudCAmJiBhcmdzWydzdGFydFRpbWUnXSAmJiBhcmdzWydyZWN1cnJlbmNlUnVsZSddKXtcblxuXG4gICAgICAgICAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IGFyZ3NbJ3N0YXJ0VGltZSddO1xuICAgICAgICAgICAgICBjb25zdCBlbmRUaW1lID0gYXJnc1snZW5kVGltZSddO1xuICAgICAgICAgICAgICBjb25zdCBmcmVxICAgPSBhcmdzWydyZWN1cnJlbmNlUnVsZSddLnNwbGl0KCc7JylbMF0uc3BsaXQoJz0nKVsxXTtcbiAgICAgICAgICAgICAgbGV0IGZyZXFMYWJlbCA9ICdEYWlseSc7XG4gICAgICAgICAgICAgIC8vY3VzdG9tIGRhdGUgc2VsZWN0ZWRcbiAgICAgICAgICAgICAgaWYoYXJnc1sncmVjdXJyZW5jZVJ1bGUnXS5pbmRleE9mKFwiUkRBVEVcIikgPiAtMSl7XG4gICAgICAgICAgICAgICAgZnJlcUxhYmVsID0gJ011bHRpcGxlIERhdGVzJztcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBwcmVkZWZpbmVkIFIgUnVsZVxuICAgICAgICAgICAgICAgIGlmKGZyZXEudG9Mb3dlckNhc2UoKSA9PSAnV2Vla2x5Jy50b0xvd2VyQ2FzZSgpKXtcbiAgICAgICAgICAgICAgICAgIGxldCBieURheXMgPSBhcmdzWydyZWN1cnJlbmNlUnVsZSddLnNwbGl0KCc7JylbMl0uc3BsaXQoJz0nKVsxXS5zcGxpdCgnLCcpO1xuICAgICAgICAgICAgICAgICAgaWYoYnlEYXlzLmxlbmd0aCA+IDIpe1xuICAgICAgICAgICAgICAgICAgICBmcmVxTGFiZWwgPSAnTXVsdGlwbGUgRGF0ZXMnO1xuICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZnJlcUxhYmVsID0gJ0V2ZXJ5ICc7XG4gICAgICAgICAgICAgICAgICAgIGZvcihsZXQgaW5kZXggPSAwO2luZGV4IDwgYnlEYXlzLmxlbmd0aDsgaW5kZXgrKyl7XG4gICAgICAgICAgICAgICAgICAgICAgZnJlcUxhYmVsICs9IHRoaXMuZGF5c1tieURheXNbaW5kZXhdXTtcbiAgICAgICAgICAgICAgICAgICAgICBpZihpbmRleCA8IChieURheXMubGVuZ3RoIC0gMSkpe1xuICAgICAgICAgICAgICAgICAgICAgICAgZnJlcUxhYmVsICs9ICcsICc7XG4gICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHJldHVybiAgKGVuZFRpbWUgIT0gdW5kZWZpbmVkID8gJycgOiBmcmVxTGFiZWwpICsgIChoaWRlVGltZSA/ICAnJyA6ICgnIHwgJyArIHN0YXJ0VGltZSArIChlbmRUaW1lICE9IHVuZGVmaW5lZCA/ICcgdG8gJyArIGVuZFRpbWUgOiAnJyApKSApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgbGV0IGxvY2FsID0gRGF0ZVRpbWUubG9jYWwoKS5zZXRab25lKGV2ZW50VGltZVpvbmUpO1xuICAgICAgICAgICAgICAvLyBmb3Igb3RoZXIgZXZlbnRzIG9yIGZhbGxiYWNrXG4gICAgICAgICAgICAgIGNvbnN0IGRhdGUgPSByYW5nZURhdGVzLm1hcChkID0+IERhdGVUaW1lLmZyb21JU08oZCAsIHsgem9uZTogZXZlbnRUaW1lWm9uZSB9KS50b0Zvcm1hdCgnZGQnKSk7XG4gICAgICAgICAgICAgIGNvbnN0IG1vbnRoID0gcmFuZ2VEYXRlcy5tYXAoZCA9PiBEYXRlVGltZS5mcm9tSVNPKGQsIHsgem9uZTogZXZlbnRUaW1lWm9uZSB9KS50b0Zvcm1hdCgnTU1NJykpO1xuICAgICAgICAgICAgICBjb25zdCB5ZWFyID0gcmFuZ2VEYXRlcy5tYXAoZCA9PiBEYXRlVGltZS5mcm9tSVNPKGQsIHsgem9uZTogZXZlbnRUaW1lWm9uZSB9KS50b0Zvcm1hdCgneXknKSk7XG4gICAgICAgICAgICAgIGNvbnN0IHRpbWUgPSBEYXRlVGltZS5mcm9tSVNPKHJhbmdlRGF0ZXNbMF0sIHsgem9uZTogZXZlbnRUaW1lWm9uZSB9KS50b0Zvcm1hdCgnaGg6bW0gYScpO1xuXG4gICAgICAgICAgICAgIGNvbnN0IGN1cnJZZWFyID0gbmV3IERhdGUoKS5nZXRVVENGdWxsWWVhcigpJSAxMDA7XG4gICAgICAgICAgICAgIGlmICh5ZWFyWzBdICE9PSB5ZWFyWzFdKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1vbnRoWzBdICsgJyAnICsgZGF0ZVswXSArICdcXCcnICsgeWVhclswXSArICcgLSAnICsgbW9udGhbMV0gKyAnICcgKyBkYXRlWzFdICsgJ1xcJycgKyB5ZWFyWzFdICsgKGhpZGVUaW1lID8gJycgOiAgJyB8ICcgKyB0aW1lKTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCB5ZWFyU3QgPSAoeWVhclswXSAtIGN1cnJZZWFyKSAhPSAwID8gXCIgJ1wiK3llYXJbMF0gOiAnJztcbiAgICAgICAgICAgICAgICBpZiAoKGRhdGVbMF0gPT09IGRhdGVbMV0pICYmIChtb250aFswXSA9PT0gbW9udGhbMV0pKSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gbW9udGhbMF0gKyAnICcgKyBkYXRlWzBdICsgeWVhclN0ICsgKGhpZGVUaW1lID8gJycgOiAnIHwgJyArIHRpbWUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoKG1vbnRoWzBdICE9PSBtb250aFsxXSkpIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiBtb250aFswXSArICcgJyArIGRhdGVbMF0gKyB5ZWFyU3QgKyAnIC0gJyArIG1vbnRoWzFdICsgJyAnICsgZGF0ZVsxXSArIHllYXJTdCArIChoaWRlVGltZSA/ICcnIDogJyB8ICcgKyB0aW1lKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIG1vbnRoWzBdICsgJyAnICsgZGF0ZVswXSArICcgLSAnICsgZGF0ZVsxXSArIHllYXJTdCArIChoaWRlVGltZSA/ICcnIDogJyB8ICcgKyB0aW1lKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgfVxufVxuIl19